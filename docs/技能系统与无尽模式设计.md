# 丧尸危机跑酷：技能系统 & 无尽模式 需求/设计描述文档（可扩充版）

## 1. 项目概述（现状基线）
- **游戏类型**：跑酷 + 射击 + 养成（武器/子弹升级）。
- **地图结构**：5 条跑道（Lane 1-5），场景/地面持续向后运动（玩家相对前进）。
- **核心操作**：
  - **切换跑道**躲避障碍、拾取道具、对齐目标。
  - **射击**攻击沿途丧尸（武器基础为手枪，拾取道具升级）。
- **关卡流程**：
  - 跑道延申至尽头后停止生成 -> **出现关卡 BOSS** -> 击败后胜利 -> 领取奖励 -> 进入下一关卡。
- **难度递增**：随关卡增加，障碍/丧尸强度与密度提升，BOSS更强。

---
todo：
丰富主菜单，我希望游戏添加以下模块：
1.角色培养：通过击杀僵尸掉落金币升级角色天赋（比如生命值，攻击力）或角色技能
2.武器升级：花费金币为当前已经出现的武器进行升级，如射速和初始弹道；


## 2. 新目标 A：角色技能系统（主动技能）

### 2.1 设计目标
- 为角色加入可成长的“战斗策略层”，让玩家在躲避与输出之间做选择。
- 技能应具备：
  - **解锁机制**（拾取特定道具 或 积累能量）
  - **使用机制**（主动触发）
  - **冷却时间**（Cooldown）
  - **可扩展性**（后续新增技能/改数值无需大改架构）

---

## 2.2 技能系统核心概念与数据模型（建议）
> 这一部分用于后续扩充时统一口径：你新增技能只需要补充“技能定义”和“效果逻辑”。

### 2.2.1 技能状态（建议字段）
- **SkillId**：唯一标识（`dash` / `shield` / `aoe`）。
- **unlocked**：是否已解锁。
- **cooldownSeconds**：冷却总时长。
- **cooldownRemaining**：剩余冷却。
- **durationSeconds**：持续时间（没有持续则为 0）。
- **activeRemaining**：剩余持续时间。
- **energyCost**：消耗能量（或消耗充能次数）。
- **level**（可选）：技能等级，用于后续扩展（加持续、减CD、增伤等）。

### 2.2.2 能量系统（2选1，或混合）
- **方案A：统一能量条（推荐）**
  - **energyCurrent / energyMax**
  - 获取能量来源：
    - 击杀丧尸
    - 生存时间累计
    - 拾取“能量电池”类道具
  - 技能消耗能量并进入冷却（能量不足不可释放）。
- **方案B：技能独立充能**
  - 每个技能有 `charges` 与 `chargeMax`
  - 通过拾取对应技能道具增加充能（更偏“道具驱动”）。

**建议混合策略**：解锁靠道具，释放靠能量 + 冷却（更有成长线，也更好做无尽模式的数值平衡）。

---

## 2.3 三种主动技能定义

### 2.3.1 技能 1：冲刺（Dash）
- **定位**：位移/生存技能，用于“强行穿越危险区域”或“快速对齐道具/目标”。
- **触发效果**：
  - 短时间内大幅提升移动速度（或跑道切换速度/判定位移速度）。
  - **免疫碰撞**（与障碍物/丧尸的碰撞伤害与阻挡判定失效）。
- **关键数值（建议初始）**：
  - **持续时间**：1.0-1.5s
  - **速度倍率**：1.8x-2.5x
  - **冷却**：8-12s
  - **能量消耗**：25-40
- **交互细节**：
  - 冲刺期间仍可射击（建议保留射击以维持爽感）。
  - 若你有“跑道切换动画/插值”，冲刺可提高插值速度或允许连续切换更快。
- **可扩充方向**：
  - 升级后追加“冲刺轨迹伤害”（撞到丧尸造成击退/伤害）
  - 减冷却 / 增持续 / 增能量收益

---

### 2.3.2 技能 2：护盾（Shield）
- **定位**：保命技能，稳定容错，适合与高密度障碍/高伤害敌人对抗。
- **触发效果**：
  - 在短时间内生成护盾，**抵挡一次伤害**（来自碰撞或丧尸攻击）。
  - 抵挡成功后护盾消失（即使持续时间未结束）。
- **关键数值（建议初始）**：
  - **持续时间**：3-5s
  - **抵挡次数**：1 次（后续升级可变 2 次）
  - **冷却**：10-15s
  - **能量消耗**：20-35
- **交互细节**：
  - “伤害”的定义需要统一：碰撞伤害、远程伤害、持续伤害是否都可挡。
  - 护盾存在时建议给清晰视觉反馈（角色光圈/血条旁盾牌图标）。
- **可扩充方向**：
  - 抵挡后给予短暂加速/无敌 0.3s
  - 抵挡时反弹伤害给附近丧尸（与范围攻击形成联动）

---

### 2.3.3 技能 3：范围攻击（AOE / Shockwave）
- **定位**：清场技能，用于被包围或丧尸密度过高时“找回节奏”。
- **触发效果**：
  - 对角色周围一定半径内的丧尸造成伤害（可选击退）。
  - 对障碍物通常无效（避免破坏跑酷核心），但可为后续扩展保留开关。
- **关键数值（建议初始）**：
  - **范围半径**：中等（覆盖 2-3 条跑道宽度的视觉范围）
  - **基础伤害**：按“当前武器伤害”的某个倍率计算（例如 2.0x），保持随武器成长
  - **冷却**：12-18s
  - **能量消耗**：35-60
- **交互细节**：
  - AOE 是否对 BOSS 生效：建议 **部分生效**（例如伤害衰减或仅造成小额伤害），否则会过强。
- **可扩充方向**：
  - 附加属性（燃烧/减速/易伤）
  - 变体技能：锥形喷火、手雷投掷、雷电链等（复用同一“范围伤害系统”）

---

## 2.4 技能解锁与道具设计

### 2.4.1 解锁方式
- **方式1：拾取特定道具解锁**
  - `Dash Core`：解锁冲刺
  - `Shield Module`：解锁护盾
  - `Pulse Emitter`：解锁范围攻击
- **方式2：能量累计解锁（保底机制）**
  - 例如“本局累计能量获取达到 X 自动解锁一个技能槽位”
  - 避免玩家运气差一直不出关键道具

### 2.4.2 技能使用方式
- 解锁后技能进入“可用池”，释放需要：
  - 能量足够
  - 冷却为 0
  - 不处于禁用状态（例如某些剧情/BOSS阶段）

### 2.4.3 技能相关 UI/交互
- **技能栏（3个槽位）**：
  - 图标 + 冷却遮罩 + 能量不足灰态
- **输入方式**（根据平台选择）：
  - PC：`1/2/3` 或 `Q/E/R`
  - 移动端：屏幕右侧三个按钮
- **提示**：
  - 解锁提示：弹出短提示“已解锁：冲刺”
  - 可释放提示：图标高亮/轻微动画
  - 冷却提示：倒计时或圆环进度

---

## 3. 新目标 B：无尽模式（Endless Mode）

### 3.1 设计目标
- 地图无限生成，玩家追求：
  - **尽可能长的生存时间**
  - **尽可能高的分数**
- 难度随时间（或距离）持续上升，形成“不可避免的终局”，让排行榜有意义。

---

## 3.2 核心循环（无尽模式）
- **Start**
  - 初始化无尽参数：起始速度、密度、生成表
- **Loop**
  - 持续生成跑道段（chunks）
  - 障碍物和丧尸生成密度逐渐增加
  - 玩家生存/击杀/拾取 -> 得分与成长
- **End**
  - 玩家死亡或失败 -> 结算分数、生存时间、击杀数等
  - 若刷新纪录 -> 写入最高分/最高生存时间
  - 更新排行榜条目

---

## 3.3 无限生成（地图/内容生成）

### 3.3.1 地图片段（Chunk）思想（推荐）
- 将地图按时间轴拆成连续“片段”，每个片段包含：
  - 本片段持续长度（时间/距离）
  - 障碍生成列表
  - 丧尸生成列表
  - 道具生成列表
- 游戏只维护“前方若干片段”，玩家跑过后销毁旧片段，持续追加新片段。

### 3.3.2 生成难度曲线（密度递增）
定义一个“难度等级”变量 `D`（随生存时间或距离增长）：
- **障碍密度**：`obstacleRate = base + k1 * D`
- **丧尸密度**：`zombieRate = base + k2 * D`
- **移动速度**：`speed = base * (1 + k3 * D)`（谨慎增加，太快会不可玩）
- **丧尸强度**：
  - 血量：`hp = base * (1 + k4 * D)`
  - 移速/攻击频率（如果有）：逐步上升

**约束建议**：
- 给密度设置上限或采用分段函数，避免后期完全不可解。
- 通过“技能/升级掉落”给玩家对冲难度上升。

---

## 3.4 计分系统（Score）

### 3.4.1 分数来源（建议）
- **生存时间分**：每秒 +X 分（核心保证玩家不靠刷怪也能有分）
- **击杀分**：普通丧尸 +Y，精英 +Y2
- **连杀/连击加成**：
  - 连续击杀在时间窗口内增加 multiplier（例如 1.0 -> 1.2 -> 1.5）
- **拾取分**：
  - 武器升级道具 +A
  - 子弹升级道具 +B
  - 技能解锁/能量道具 +C

### 3.4.2 结算统计（用于排行榜展示）
- `score`：总分
- `survivalTimeMs`：生存时间
- `kills`：击杀数
- `maxCombo`：最高连杀（可选）
- `date`：时间戳
- `mode`：`endless`（为未来模式扩展预留）

---

## 3.5 最高记录与排行榜（Leaderboard）

### 3.5.1 存储范围（建议分层）
- **本地排行榜（MVP）**：
  - 使用本地存储（如浏览器 `localStorage`）保存 Top N（例如 Top 20）
  - 优点：无服务端、易实现
- **在线排行榜（后续扩展）**：
  - 需要后端与反作弊策略（不在本期强制范围内）

### 3.5.2 排行榜条目结构（建议）
- `playerName`（可选，默认“玩家”+随机编号）
- `score`
- `survivalTimeMs`
- `kills`
- `createdAt`

### 3.5.3 排序规则（建议）
- 第一关键字：`score` 降序
- 第二关键字：`survivalTimeMs` 降序（分数相同看谁更久）
- 第三关键字：`createdAt` 升序（更早者优先或按你喜好）

### 3.5.4 UI 建议
- **入口**：主菜单加入“无尽模式”“排行榜”
- **排行榜页**：
  - Top N 表格（名次、分数、生存时间、击杀、日期）
  - 高亮当前新纪录
  - 提供“清空排行榜”（需要二次确认）

---

## 4. 与关卡模式共存的模式架构建议
为避免未来扩充时互相影响，建议抽象“模式参数”：
- **Mode: `level`**
  - 有尽头、BOSS、胜利/奖励
  - 难度随关卡编号增长
- **Mode: `endless`**
  - 无尽头、周期性精英/事件、阶段性奖励、生存挑战
  - 难度随时间/距离增长
  - 强依赖分数与排行榜

---

## 5. 可扩充点清单（你后续加功能时可直接挂靠）
- **技能扩充**：
  - 新技能类型（投掷物、召唤、陷阱、瞬移）
  - 技能升级树（等级、符文、天赋）
  - 技能联动（冲刺命中触发 AOE，护盾碎裂反伤等）
- **无尽事件系统**：
  - 每 X 秒触发事件：尸潮、毒雾、补给箱、精英追击
- **掉落与经济系统**：
  - 局内货币 -> 局外永久升级
- **敌人多样化**：
  - 自爆僵尸、远程僵尸、装甲僵尸、Boss-like 精英
- **反作弊/在线榜**（后续）：
  - 服务端签名、回放验证、种子与生成记录
